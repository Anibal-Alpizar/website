---
import Section from './Section.astro'

import { work } from '../data/cv.json'
---

<Section>
  <table>
    <thead>
      <tr>
        <th scope="col">Date</th>
        <th scope="col">Title</th>
        <th scope="col">Position</th>
      </tr>
    </thead>
    <tbody>
      {
        work.map(({ name, endDate, position }) => {
          const endYear =
            endDate != null ? new Date(endDate).getFullYear() : 'Current'

          const slug = name.toLowerCase().replace(/\s+/g, '-')

          return (
            <tr
              class="clickable-row"
              data-url={`/2024/${slug}`}
              role="link"
              tabindex="0"
            >
              <td>{endYear}</td>
              <td>{name}</td>
              <td>{position}</td>
            </tr>
          )
        })
      }
    </tbody>
  </table>
</Section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.clickable-row').forEach((row) => {
      row.addEventListener('click', () => {
        const url = row.getAttribute('data-url')
        if (url) window.location.href = url
      })
    })
  })
</script>

<style>
  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
  }

  th,
  td {
    padding: 18px;
    text-align: left;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  th:nth-child(1),
  td:nth-child(1) {
    width: 80px;
  }

  th:nth-child(2),
  td:nth-child(2) {
    width: 55%;
    padding-right: 3px;
  }

  th:nth-child(3),
  td:nth-child(3) {
    width: 30%;
  }

  th {
    font-size: 0.7rem;
    color: #333;
    text-transform: lowercase;
    border-bottom: 1px solid #ddd;
    font-weight: normal;
  }

  td {
    font-size: 0.85rem;
    color: #555;
    border-bottom: 1px solid #ddd;
  }

  tbody tr {
    transition: background-color 0.3s ease;
  }

  tbody tr:hover {
    background-color: #f5f5f5;
    cursor: pointer;
  }

  .clickable-row {
    cursor: pointer;
  }

  @media (max-width: 700px) {
    th,
    td {
      padding: 12px;
      font-size: 0.75rem;
      white-space: normal;
    }

    table {
      table-layout: auto;
    }
  }
</style>
